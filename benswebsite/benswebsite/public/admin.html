<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <style>
    body {
      background: #e1f5fe;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      height: 100vh;
      margin: 0;
    }
    #login {
      margin: auto;
      padding: 2em;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    #panel {
      display: none;
      flex: 1;
      flex-direction: row;
    }
    #tickets {
      width: 30%;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      background: #fafafa;
    }
    .ticket {
      padding: 1em;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }
    .ticket.active {
      background: #bbdefb;
    }
    #chat {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 1em;
      background: white;
    }
    #message-form {
      display: flex;
      padding: 1em;
      background: #1976d2;
    }
    #message-form input {
      flex: 1;
      padding: 1em;
      border: none;
      border-radius: 5px;
      margin-right: 1em;
    }
    #message-form button {
      padding: 1em;
      background: #0d47a1;
      color: white;
      border: none;
      border-radius: 5px;
    }
    .msg {
      margin-bottom: 0.8em;
    }
    .user { color: #1a237e; }
    .admin { color: #004d40; }
  </style>
</head>
<body>

<div id="login">
  <h2>Admin Login</h2>
  <input type="password" id="code" placeholder="Enter Admin Code (7453)" /><br/><br/>
  <button onclick="login()">Enter</button>
</div>

<div id="panel">
  <div id="tickets"></div>
  <div id="chat">
    <div id="messages"></div>
    <form id="message-form" onsubmit="sendMessage(event)">
      <input id="message-input" placeholder="Reply..." required />
      <button>Send</button>
    </form>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  let selectedUser = '';

  function login() {
    const code = document.getElementById('code').value;
    if (code === '7453') {
      document.getElementById('login').style.display = 'none';
      document.getElementById('panel').style.display = 'flex';
      socket.emit('adminJoin');
    } else {
      alert('Incorrect code.');
    }
  }

  socket.on('ticketList', users => {
    const ticketList = document.getElementById('tickets');
    ticketList.innerHTML = '';
    users.forEach(u => {
      const div = document.createElement('div');
      div.className = 'ticket';
      div.textContent = u;
      div.onclick = () => {
        selectedUser = u;
        document.querySelectorAll('.ticket').forEach(el => el.classList.remove('active'));
        div.classList.add('active');
        document.getElementById('messages').innerHTML = '';
        socket.emit('loadMessages', u);
      };
      ticketList.appendChild(div);
    });
  });

  socket.on('chat', msg => {
    if (msg.username !== selectedUser) return;
    const el = document.createElement('div');
    el.className = 'msg';
    el.innerHTML = `<b class="${msg.sender === 'admin' ? 'admin' : 'user'}">${msg.sender}:</b> ${msg.text}`;
    document.getElementById('messages').appendChild(el);
    document.getElementById('messages').scrollTop = 999999;
  });

  function sendMessage(e) {
    e.preventDefault();
    const input = document.getElementById('message-input');
    const text = input.value;
    if (!selectedUser) return alert('Select a user first.');
    socket.emit('adminMessage', { to: selectedUser, text });
    input.value = '';
  }
</script>

</body>
</html>
